Description,Step,Type,Table,Out Col,In Col,Func
#,,,,,,
Add unique tour ids to individual tour file,step_1,raw,,,,maxtours = indivTourData_3['person_id'].value_counts().max()
Add unique tour ids to individual tour file,step_1,raw,,,,"indivTourData_3['cummulative_tours'] = range(1, indivTourData_3.shape[0] + 1)"
Add unique tour ids to individual tour file,step_1,raw,,,,"indivTourData_3['last_person'] = np.hstack(([0], indivTourData_3['person_id'][:-1]))"
Add unique tour ids to individual tour file,step_1,raw,,,,indivTourData_3['new_person'] = (indivTourData_3['person_id']) != (indivTourData_3['last_person'])
Add unique tour ids to individual tour file,step_1,raw,,,,"indivTourData_3['to_subtract'] = indivTourData_3['new_person'] * np.hstack(([0], indivTourData_3['cummulative_tours'].iloc[:-1]))"
Add unique tour ids to individual tour file,step_1,raw,,,,"for i in range(maxtours): indivTourData_3['to_subtract'] = np.where(indivTourData_3['to_subtract'] == 0, np.hstack(([0], indivTourData_3['to_subtract'].iloc[:-1])), indivTourData_3['to_subtract'])"
Add unique tour ids to individual tour file,step_1,raw,,,,indivTourData_3['tour_id2'] = indivTourData_3['cummulative_tours'] - indivTourData_3['to_subtract']
#,,,,,,
Add unique tour ids to individual trip file,step_1,raw,,,,maxtrips = indivTripData_3['person_id'].value_counts().max()
Add unique tour ids to individual trip file,step_1,raw,,,,indivTripData_3['new_tour'] = (indivTripData_3['orig_purpose'] == 'Home') | ((indivTripData_3['tour_purpose'] == 'Work-Based') & (indivTripData_3['orig_purpose'] == 'Work'))
Add unique tour ids to individual trip file,step_1,raw,,,,indivTripData_3['cummulative_tours'] = np.cumsum(indivTripData_3['new_tour'])
Add unique tour ids to individual trip file,step_1,raw,,,,"indivTripData_3['last_person'] = np.hstack(([0], indivTripData_3['person_id'][:-1]))"
Add unique tour ids to individual trip file,step_1,raw,,,,indivTripData_3['new_person'] = (indivTripData_3['person_id']) != (indivTripData_3['last_person'])
Add unique tour ids to individual trip file,step_1,raw,,,,"indivTripData_3['to_subtract'] = indivTripData_3['new_person'] * np.hstack(([0], indivTripData_3['cummulative_tours'].iloc[:-1]))"
Add unique tour ids to individual trip file,step_1,raw,,,,"for i in range(maxtrips): indivTripData_3['to_subtract'] = np.where(indivTripData_3['to_subtract'] == 0, np.hstack(([0], indivTripData_3['to_subtract'].iloc[:-1])), indivTripData_3['to_subtract'])"
Add unique tour ids to individual trip file,step_1,raw,,,,indivTripData_3['tour_id2'] = indivTripData_3['cummulative_tours'] - indivTripData_3['to_subtract']
#,,,,,,
Get tour origin TAZ,step_1,raw,,,,indivTourData_3['originTAZ'] = indivTourData_3['orig_mgra'].map(geographicXwalk_PMSA.set_index('mgra')['taz']).fillna(0)
Get tour destination TAZ,step_1,raw,,,,indivTourData_3['destinationTAZ'] = indivTourData_3['dest_mgra'].map(geographicXwalk_PMSA.set_index('mgra')['taz']).fillna(0)
Get tour origin TAZ,step_1,raw,,,,jointTourData_3['originTAZ'] = jointTourData_3['orig_mgra'].map(geographicXwalk_PMSA.set_index('mgra')['taz']).fillna(0)
Get tour destination TAZ,step_1,raw,,,,jointTourData_3['destinationTAZ'] = jointTourData_3['dest_mgra'].map(geographicXwalk_PMSA.set_index('mgra')['taz']).fillna(0)
Get trip origin TAZ,step_1,raw,,,,indivTripData_3['originTAZ'] = indivTripData_3['orig_mgra'].map(geographicXwalk_PMSA.set_index('mgra')['taz']).fillna(0)
Get trip destination TAZ,step_1,raw,,,,indivTripData_3['destinationTAZ'] = indivTripData_3['dest_mgra'].map(geographicXwalk_PMSA.set_index('mgra')['taz']).fillna(0)
Get trip origin TAZ,step_1,raw,,,,jointTripData_3['originTAZ'] = jointTripData_3['orig_mgra'].map(geographicXwalk_PMSA.set_index('mgra')['taz']).fillna(0)
Get trip destination TAZ,step_1,raw,,,,jointTripData_3['destinationTAZ'] = jointTripData_3['dest_mgra'].map(geographicXwalk_PMSA.set_index('mgra')['taz']).fillna(0)
#,,,,,,
Trip OD raw distance,step_1,skim,indivTripData_3,od_distance,"originTAZ,destinationTAZ",traffic_skims_MD['MD_SOV_TR_H_DIST']
Trip OD raw distance,step_1,skim,jointTripData_3,od_distance,"originTAZ,destinationTAZ",traffic_skims_MD['MD_SOV_TR_H_DIST']
#,,,,,,
Get person hh ID and number,step_1,raw,,,,personData_3['hhper_id'] = personData_3['hh_id'].astype(str) + '-' + personData_3['person_num'].astype(str)
Cap Auto Ownership,step_1,cap,aoResults,HHVEH,AO,4
Cap Auto Ownership,step_1,cap,aoResults_Pre,HHVEH,AO,4
Cap Auto Ownership,step_1,cap,householdData_3,HHVEH,autos,4
Rename wsLoc columns,step_1,rename,wsLoc,,,"{'taz_x': 'HHTAZ', 'taz_y': 'WTAZ', 'taz': 'STAZ', 'pmsa_x': 'HDISTRICT', 'pmsa_y': 'WDISTRICT', 'pmsa': 'SDISTRICT'}"
Get work location distances,step_1,skim,wsLoc,WorkLocationDistance,"HHTAZ,WTAZ",traffic_skims_MD['MD_SOV_TR_H_DIST']
Get school location distances,step_1,skim,wsLoc,SchoolLocationDistance,"HHTAZ,STAZ",traffic_skims_MD['MD_SOV_TR_H_DIST']
Bin distances to work,step_1,bin,wsLoc,workdistbin,WorkLocationDistance,[-99999] + list(range(51)) + [99999]
Bin distances to school,step_1,bin,wsLoc,schooldistbin,SchoolLocationDistance,[-99999] + list(range(51)) + [99999]
Recode distance bin to maximum,step_1,apply,wsLoc,workdistbin,workdistbin,"(lambda x: int(float(str(x).split(', ')[1].split(']')[0])))"
Recode distance bin to maximum,step_1,apply,wsLoc,schooldistbin,schooldistbin,"(lambda x: int(float(str(x).split(', ')[1].split(']')[0])))"
Bin tour distance,step_1,bin,indivTourData_3,tourdistbin,tour_distance,list(range(42)) + [99999]
Bin tour distance,step_1,bin,jointTourData_3,tourdistbin,tour_distance,list(range(42)) + [99999]
Recode distance bin to maximum,step_1,apply,indivTourData_3,tourdistbin,tourdistbin,"(lambda x: int(float(str(x).split(', ')[1].split(']')[0])))"
Recode distance bin to maximum,step_1,apply,jointTourData_3,tourdistbin,tourdistbin,"(lambda x: int(float(str(x).split(', ')[1].split(']')[0])))"
Reset work/school location index,step_1,raw,wsLoc,,,wsLoc = wsLoc.reset_index()
Classify Person Type,step_1,replace,personData_3,PERTYPE,type,"{'Full-time worker': 1, 'Part-time worker': 2,  'University student': 3, 'Non-worker': 4, 'Retired': 5, 'Student of driving age': 6, 'Student of non-driving age': 7, 'Child too young for school': 8}"
Reclassify activity pattern,step_1,raw,personData_3,activity_pattern,,"personData_3['activity_pattern'] = np.where((personData_3['activity_pattern'] == 'M') & (personData_3['imf_choice'] == 0),  np.where(personData_3['inmf_choice'] > 0, 'N', 'H'), personData_3['activity_pattern'])"
Calculate HH Size,step_1,raw,householdData_3,HHSIZ,,"householdData_3['HHSIZ'] = householdData_3['hh_id'].map(personData_3[['hh_id', 'person_id']].groupby('hh_id').count()['person_id'])"
Cap Household Size at 5,step_1,cap,householdData_3,HHSIZE,HHSIZ,5
Identify households with joint tour present,step_1,apply,householdData_3,JOINT,cdap_pattern,(lambda x: int(x[-1] == 'j'))
#,,,,,,
Recode individual tour purposes,step_1,replace,indivTourData_3,TOURPURP,tour_purpose,"{'Home': 0, 'Work': 1, 'University': 2,  'School': 3, 'Escort': 4, 'Shop': 5, 'Maintenance': 6, 'Eating Out': 7, 'Visiting': 8, 'Discretionary': 9, 'Work-Based': 10, 'work related': 10}"
Recode joint tour purposes,step_1,replace,jointTourData_3,TOURPURP,tour_purpose,"{'Home': 0, 'Work': 1, 'University': 2,  'School': 3, 'Escort': 4, 'Shop': 5, 'Maintenance': 6, 'Eating Out': 7, 'Visiting': 8, 'Discretionary': 9, 'Work-Based': 10, 'work related': 10}"
Recode individual trip origin purposes,step_1,replace,indivTripData_3,OPURP,orig_purpose,"{'Home': 0, 'Work': 1, 'University': 2,  'School': 3, 'Escort': 4, 'Shop': 5, 'Maintenance': 6, 'Eating Out': 7, 'Visiting': 8, 'Discretionary': 9, 'Work-Based': 10, 'work related': 10}"
Recode individual trip destination purposes,step_1,replace,indivTripData_3,DPURP,dest_purpose,"{'Home': 0, 'Work': 1, 'University': 2,  'School': 3, 'Escort': 4, 'Shop': 5, 'Maintenance': 6, 'Eating Out': 7, 'Visiting': 8, 'Discretionary': 9, 'Work-Based': 10, 'work related': 10}"
Recode individual trip tour purposes,step_1,replace,indivTripData_3,TOURPURP,tour_purpose,"{'Home': 0, 'Work': 1, 'University': 2,  'School': 3, 'Escort': 4, 'Shop': 5, 'Maintenance': 6, 'Eating Out': 7, 'Visiting': 8, 'Discretionary': 9, 'Work-Based': 10, 'work related': 10}"
Recode joint trip origin purposes,step_1,replace,jointTripData_3,OPURP,orig_purpose,"{'Home': 0, 'Work': 1, 'University': 2,  'School': 3, 'Escort': 4, 'Shop': 5, 'Maintenance': 6, 'Eating Out': 7, 'Visiting': 8, 'Discretionary': 9, 'Work-Based': 10, 'work related': 10}"
Recode joint trip destination purposes,step_1,replace,jointTripData_3,DPURP,dest_purpose,"{'Home': 0, 'Work': 1, 'University': 2,  'School': 3, 'Escort': 4, 'Shop': 5, 'Maintenance': 6, 'Eating Out': 7, 'Visiting': 8, 'Discretionary': 9, 'Work-Based': 10, 'work related': 10}"
Recode joint trip tour purposes,step_1,replace,jointTripData_3,TOURPURP,tour_purpose,"{'Home': 0, 'Work': 1, 'University': 2,  'School': 3, 'Escort': 4, 'Shop': 5, 'Maintenance': 6, 'Eating Out': 7, 'Visiting': 8, 'Discretionary': 9, 'Work-Based': 10, 'work related': 10}"
#,,,,,,
Classify individual tour purpose,step_1,replace,indivTourData_3,AGGPURP,TOURPURP,"{1: '1: Work', 2: '2: University', 3: '3: School', 4: '4: Escort', 5: '5: Individual Maintenance', 6: '5: Individual Maintenance', 7: '6: Individual Discretionary', 8: '6: Individual Discretionary', 9: '6: Individual Discretionary', 10: '9: Work-based'}"
Classify joint tour purpose,step_1,replace,jointTourData_3,AGGPURP,TOURPURP,"{5: '7: Joint Maintenance', 6: '7: Joint Maintenance', 7: '8: Joint Discretionary', 8: '8: Joint Discretionary', 9: '8: Joint Discretionary'}"
Classify individual trip purpose,step_1,replace,indivTripData_3,AGGPURP,TOURPURP,"{1: '1: Work', 2: '2: University', 3: '3: School', 4: '4: Escort', 5: '5: Individual Maintenance', 6: '5: Individual Maintenance', 7: '6: Individual Discretionary', 8: '6: Individual Discretionary', 9: '6: Individual Discretionary', 10: '9: Work-based'}"
Classify joint trip purpose,step_1,replace,jointTripData_3,AGGPURP,TOURPURP,"{5: '7: Joint Maintenance', 6: '7: Joint Maintenance', 7: '8: Joint Discretionary', 8: '8: Joint Discretionary', 9: '8: Joint Discretionary'}"
#,,,,,,
Categorize individual tour,step_1,replace,indivTourData_3,TOURCAT,TOURPURP,"{1: 0, 2: 0, 3: 0, 4: 1, 5: 1, 6: 1, 7: 1, 8: 1, 9: 1, 10: 2}"
Categorize individual trip,step_1,replace,indivTripData_3,TOURCAT,TOURPURP,"{1: 0, 2: 0, 3: 0, 4: 1, 5: 1, 6: 1, 7: 1, 8: 1, 9: 1, 10: 2}"
Create lookup for joining individual tours and trips,step_1,raw,,,,"indivTourData_3['lookup'] = indivTourData_3[['hh_id', 'person_num', 'TOURCAT', 'tour_id2']].dot([100000, 1000, 100, 1])"
Create lookup for joining individual tours and trips,step_1,raw,,,,"indivTripData_3['lookup'] = indivTripData_3[['hh_id', 'person_num', 'TOURCAT', 'tour_id2']].dot([100000, 1000, 100, 1])"
Create lookup for joining joint tours and trips,step_1,raw,,,,"jointTourData_3['lookup'] = list(zip(jointTourData_3['hh_id'], jointTourData_3['tour_id']))"
Create lookup for joining joint tours and trips,step_1,raw,,,,"jointTripData_3['lookup'] = list(zip(jointTripData_3['hh_id'], jointTripData_3['tour_id']))"
Add column for grouping all tours,step_1,raw,,,,indivTourData_3['label'] = 'purpose'
Add column for grouping all tours,step_1,raw,,,,jointTourData_3['label'] = 'purpose'
#,,,,,,
Get tour origin TAZ for individual trips,step_1,raw,,,,indivTripData_3['TOUROTAZ'] = indivTripData_3['lookup'].map(indivTourData_3.set_index('lookup')['originTAZ'])
Get tour destination TAZ for individual trips,step_1,raw,,,,indivTripData_3['TOURDTAZ'] = indivTripData_3['lookup'].map(indivTourData_3.set_index('lookup')['destinationTAZ'])
Get tour final destination TAZ for individual trips,step_1,raw,,,,"indivTripData_3['finaldestTAZ'] = np.where(indivTripData_3['inbound'] == 0, indivTripData_3['TOURDTAZ'], indivTripData_3['TOUROTAZ'])"
Get distance from trip origin to tour final destination,step_1,skim,indivTripData_3,od_dist,"originTAZ,finaldestTAZ",traffic_skims_MD['MD_SOV_TR_H_DIST']
Get distance from trip destination to tour final destination,step_1,skim,indivTripData_3,sd_dist,"destinationTAZ,finaldestTAZ",traffic_skims_MD['MD_SOV_TR_H_DIST']
Get out of direction distance,step_1,raw,,,,indivTripData_3['out_dir_dist'] = indivTripData_3['od_distance'] + indivTripData_3['sd_dist'] - indivTripData_3['od_dist']
Add avgDist variable for grouping,step_1,raw,,,,indivTripData_3['avgDist'] = 'avgDist'
Bin out of direction distance,step_1,bin,indivTripData_3,out_dir_distbin,out_dir_dist,[-99999] + list(range(43)) + [99999]
Recode distance bin to maximum,step_1,apply,indivTripData_3,out_dir_distbin,out_dir_distbin,"(lambda x: int(float(str(x).split(', ')[1].split(']')[0]))+1)"
#,,,,,,
Get tour origin TAZ for joint trips,step_1,raw,,,,jointTripData_3['TOUROTAZ'] = jointTripData_3['lookup'].map(jointTourData_3.set_index('lookup')['originTAZ'])
Get tour destination TAZ for joint trips,step_1,raw,,,,jointTripData_3['TOURDTAZ'] = jointTripData_3['lookup'].map(jointTourData_3.set_index('lookup')['destinationTAZ'])
Get tour final destination TAZ for joint trips,step_1,raw,,,,"jointTripData_3['finaldestTAZ'] = np.where(jointTripData_3['inbound'] == 0, jointTripData_3['TOURDTAZ'], jointTripData_3['TOUROTAZ'])"
,step_1,skim,jointTripData_3,od_dist,"originTAZ,finaldestTAZ",traffic_skims_MD['MD_SOV_TR_H_DIST']
,step_1,skim,jointTripData_3,sd_dist,"destinationTAZ,finaldestTAZ",traffic_skims_MD['MD_SOV_TR_H_DIST']
,step_1,raw,,,,jointTripData_3['out_dir_dist'] = jointTripData_3['od_distance'] + jointTripData_3['sd_dist'] - jointTripData_3['od_dist']
Add avgDist variable for grouping,step_1,raw,,,,jointTripData_3['avgDist'] = 'avgDist'
Bin out of direction distance,step_1,bin,jointTripData_3,out_dir_distbin,out_dir_dist,[-99999] + list(range(43)) + [99999]
Recode distance bin to maximum,step_1,apply,jointTripData_3,out_dir_distbin,out_dir_distbin,"(lambda x: int(float(str(x).split(', ')[1].split(']')[0]))+1)"
#,,,,,,
Add in zeros at end of tour participant string to prevent index error,step_1,apply,jointTourData_3,tour_participants,tour_participants,lambda x: x + (8 - (len(x)+1)//2)*' 0'
Identify person 1 on joint tour,step_1,apply,jointTourData_3,PER1,tour_participants,"lambda x: x.replace(' ', '')[0]"
Identify person 2 on joint tour,step_1,apply,jointTourData_3,PER2,tour_participants,"lambda x: x.replace(' ', '')[1]"
Identify person 3 on joint tour,step_1,apply,jointTourData_3,PER3,tour_participants,"lambda x: x.replace(' ', '')[2]"
Identify person 4 on joint tour,step_1,apply,jointTourData_3,PER4,tour_participants,"lambda x: x.replace(' ', '')[3]"
Identify person 5 on joint tour,step_1,apply,jointTourData_3,PER5,tour_participants,"lambda x: x.replace(' ', '')[4]"
Identify person 6 on joint tour,step_1,apply,jointTourData_3,PER6,tour_participants,"lambda x: x.replace(' ', '')[5]"
Identify person 7 on joint tour,step_1,apply,jointTourData_3,PER7,tour_participants,"lambda x: x.replace(' ', '')[6]"
Identify person 8 on joint tour,step_1,apply,jointTourData_3,PER8,tour_participants,"lambda x: x.replace(' ', '')[7]"
#,,,,,,
Get individual tour person type,step_1,raw,,,,indivTourData_3['PERTYPE'] = (indivTourData_3['hh_id'].astype(str) + '-' + indivTourData_3['person_num'].astype(str)).map(personData_3.set_index('hhper_id')['PERTYPE']).fillna(0)
Get individual trip person type,step_1,raw,,,,indivTripData_3['PERTYPE'] = (indivTripData_3['hh_id'].astype(str) + '-' + indivTripData_3['person_num'].astype(str)).map(personData_3.set_index('hhper_id')['PERTYPE']).fillna(0)
Get person type for joint tour participant 1,step_1,raw,,,,jointTourData_3['PTYPE1'] = (jointTourData_3['hh_id'].astype(str) + '-' + jointTourData_3['PER1'].astype(str)).map(personData_3.set_index('hhper_id')['PERTYPE']).fillna(0)
Get person type for joint tour participant 2,step_1,raw,,,,jointTourData_3['PTYPE2'] = (jointTourData_3['hh_id'].astype(str) + '-' + jointTourData_3['PER2'].astype(str)).map(personData_3.set_index('hhper_id')['PERTYPE']).fillna(0)
Get person type for joint tour participant 3,step_1,raw,,,,jointTourData_3['PTYPE3'] = (jointTourData_3['hh_id'].astype(str) + '-' + jointTourData_3['PER3'].astype(str)).map(personData_3.set_index('hhper_id')['PERTYPE']).fillna(0)
Get person type for joint tour participant 4,step_1,raw,,,,jointTourData_3['PTYPE4'] = (jointTourData_3['hh_id'].astype(str) + '-' + jointTourData_3['PER4'].astype(str)).map(personData_3.set_index('hhper_id')['PERTYPE']).fillna(0)
Get person type for joint tour participant 5,step_1,raw,,,,jointTourData_3['PTYPE5'] = (jointTourData_3['hh_id'].astype(str) + '-' + jointTourData_3['PER5'].astype(str)).map(personData_3.set_index('hhper_id')['PERTYPE']).fillna(0)
Get person type for joint tour participant 6,step_1,raw,,,,jointTourData_3['PTYPE6'] = (jointTourData_3['hh_id'].astype(str) + '-' + jointTourData_3['PER6'].astype(str)).map(personData_3.set_index('hhper_id')['PERTYPE']).fillna(0)
Get person type for joint tour participant 7,step_1,raw,,,,jointTourData_3['PTYPE7'] = (jointTourData_3['hh_id'].astype(str) + '-' + jointTourData_3['PER7'].astype(str)).map(personData_3.set_index('hhper_id')['PERTYPE']).fillna(0)
Get person type for joint tour participant 8,step_1,raw,,,,jointTourData_3['PTYPE8'] = (jointTourData_3['hh_id'].astype(str) + '-' + jointTourData_3['PER8'].astype(str)).map(personData_3.set_index('hhper_id')['PERTYPE']).fillna(0)
#,,,,,,
,step_1,raw,,,,toursPertypeDistbn = pd.DataFrame({'freq': indivTourData_3.query('PERTYPE > 0 and TOURPURP != 10')['PERTYPE'].value_counts().sort_index()})
Melt joint tours into tours by person type,step_1,raw,,,,"temp_joint = pd.melt(jointTourData_3, ['hh_id', 'tour_id'], ['PTYPE1', 'PTYPE2', 'PTYPE3', 'PTYPE4', 'PTYPE5', 'PTYPE6', 'PTYPE7', 'PTYPE8'], value_name = 'PERTYPE')"
Reset temp_joint's index,step_1,raw,,,,temp_joint = temp_joint.reset_index()
,step_1,raw,,,,jtoursPertypeDistbn = pd.DataFrame({'freq': temp_joint['PERTYPE'].astype(int).value_counts().sort_index()})
,step_1,raw,,,,totaltoursPertypeDistbn = toursPertypeDistbn.copy()
,step_1,raw,,,,totaltoursPertypeDistbn['freq'] += jtoursPertypeDistbn['freq']
,step_1,raw,,,,totaltoursPertypeDistbn.index.name = 'PERTYPE'
#,,,,,,
Number of non-mandatory tours,step_1,raw,personData_3,inmCounts,,personData_3['inmCounts'] = personData_3['person_id'].map(indivTourData_3.query('TOURPURP >= 4 and TOURPURP <= 9')['person_id'].value_counts()).fillna(0)
Number of non-mandatory tours,step_1,cap,personData_3,nmtours,inmCounts,3
Number of non-mandatory tours (rename 3 to 3pl),step_1,replace,personData_3,nmtours,nmtours,"{0: '0', 1: '1', 2: '2', 3: '3+'}"
Reset Individual Tour Index,step_1,raw,indivTourData_3,,,indivTourData_3 = indivTourData_3.reset_index()
Reset Joint Tour Index,step_1,raw,jointTourData_3,,,jointTourData_3 = jointTourData_3.reset_index()
Reset Individual Trip Index,step_1,raw,indivTourData_3,,,indivTripData_3 = indivTripData_3.reset_index()
Reset Joint Trip Index,step_1,raw,jointTourData_3,,,jointTripData_3 = jointTripData_3.reset_index()
Recode joint tour composition,step_1,replace,jointTourData_3,tour_composition,tour_composition,"{1: 'All Adult', 2: 'All Children', 3: 'Mixed'}"
Get number in HH on joint tour,step_1,apply,jointTourData_3,NUMBER_HH_TOTAL,tour_participants,"lambda x: (len(x.replace(' 0', '')) + 1)//2"
Cap NUMBER_HH,step_1,cap,jointTourData_3,NUMBER_HH,NUMBER_HH_TOTAL,5
HH Joint Tours of Purpose 5,step_1,raw,,,,householdData_3['joint5'] = householdData_3['hh_id'].map(jointTourData_3.query('TOURPURP == 5')['hh_id'].value_counts()).fillna(0)
HH Joint Tours of Purpose 6,step_1,raw,,,,householdData_3['joint6'] = householdData_3['hh_id'].map(jointTourData_3.query('TOURPURP == 6')['hh_id'].value_counts()).fillna(0)
HH Joint Tours of Purpose 7,step_1,raw,,,,householdData_3['joint7'] = householdData_3['hh_id'].map(jointTourData_3.query('TOURPURP == 7')['hh_id'].value_counts()).fillna(0)
HH Joint Tours of Purpose 8,step_1,raw,,,,householdData_3['joint8'] = householdData_3['hh_id'].map(jointTourData_3.query('TOURPURP == 8')['hh_id'].value_counts()).fillna(0)
HH Joint Tours of Purpose 9,step_1,raw,,,,householdData_3['joint9'] = householdData_3['hh_id'].map(jointTourData_3.query('TOURPURP == 9')['hh_id'].value_counts()).fillna(0)
Add all joint tours,step_1,sum,householdData_3,jtours,"joint5,joint6,joint7,joint8,joint9",
Categorize joint tours,step_1,cap,householdData_3,jointCat,jtours,2
#,,,,,,
Add joint tour frequency variable,step_1,raw,householdData_3,jtf,,householdData_3['jtf'] = np.zeros_like(householdData_3.index)
Classify joint tour frequency categories,step_1,raw,,,,"householdData_3['jtf'] = np.where(householdData_3['jtours'] == 0, 1, householdData_3['jtf'])"
Classify joint tour frequency categories,step_1,raw,,,,"householdData_3['jtf'] = np.where(householdData_3['joint5'] == 1, 2, householdData_3['jtf'])"
Classify joint tour frequency categories,step_1,raw,,,,"householdData_3['jtf'] = np.where(householdData_3['joint6'] == 1, 3, householdData_3['jtf'])"
Classify joint tour frequency categories,step_1,raw,,,,"householdData_3['jtf'] = np.where(householdData_3['joint7'] == 1, 4, householdData_3['jtf'])"
Classify joint tour frequency categories,step_1,raw,,,,"householdData_3['jtf'] = np.where(householdData_3['joint8'] == 1, 5, householdData_3['jtf'])"
Classify joint tour frequency categories,step_1,raw,,,,"householdData_3['jtf'] = np.where(householdData_3['joint9'] == 1, 6, householdData_3['jtf'])"
Classify joint tour frequency categories,step_1,raw,,,,"householdData_3['jtf'] = np.where(householdData_3['joint5'] >= 2, 7, householdData_3['jtf'])"
Classify joint tour frequency categories,step_1,raw,,,,"householdData_3['jtf'] = np.where(householdData_3['joint6'] >= 2, 8, householdData_3['jtf'])"
Classify joint tour frequency categories,step_1,raw,,,,"householdData_3['jtf'] = np.where(householdData_3['joint7'] >= 2, 9, householdData_3['jtf'])"
Classify joint tour frequency categories,step_1,raw,,,,"householdData_3['jtf'] = np.where(householdData_3['joint8'] >= 2, 10, householdData_3['jtf'])"
Classify joint tour frequency categories,step_1,raw,,,,"householdData_3['jtf'] = np.where(householdData_3['joint9'] >= 2, 11, householdData_3['jtf'])"
Classify joint tour frequency categories,step_1,raw,,,,"householdData_3['jtf'] = np.where((householdData_3['joint5'] >= 1) & (householdData_3['joint6'] >= 1), 12, householdData_3['jtf'])"
Classify joint tour frequency categories,step_1,raw,,,,"householdData_3['jtf'] = np.where((householdData_3['joint5'] >= 1) & (householdData_3['joint7'] >= 1), 13, householdData_3['jtf'])"
Classify joint tour frequency categories,step_1,raw,,,,"householdData_3['jtf'] = np.where((householdData_3['joint5'] >= 1) & (householdData_3['joint8'] >= 1), 14, householdData_3['jtf'])"
Classify joint tour frequency categories,step_1,raw,,,,"householdData_3['jtf'] = np.where((householdData_3['joint5'] >= 1) & (householdData_3['joint9'] >= 1), 15, householdData_3['jtf'])"
Classify joint tour frequency categories,step_1,raw,,,,"householdData_3['jtf'] = np.where((householdData_3['joint6'] >= 1) & (householdData_3['joint7'] >= 1), 16, householdData_3['jtf'])"
Classify joint tour frequency categories,step_1,raw,,,,"householdData_3['jtf'] = np.where((householdData_3['joint6'] >= 1) & (householdData_3['joint8'] >= 1), 17, householdData_3['jtf'])"
Classify joint tour frequency categories,step_1,raw,,,,"householdData_3['jtf'] = np.where((householdData_3['joint6'] >= 1) & (householdData_3['joint9'] >= 1), 18, householdData_3['jtf'])"
Classify joint tour frequency categories,step_1,raw,,,,"householdData_3['jtf'] = np.where((householdData_3['joint7'] >= 1) & (householdData_3['joint8'] >= 1), 19, householdData_3['jtf'])"
Classify joint tour frequency categories,step_1,raw,,,,"householdData_3['jtf'] = np.where((householdData_3['joint7'] >= 1) & (householdData_3['joint9'] >= 1), 20, householdData_3['jtf'])"
Classify joint tour frequency categories,step_1,raw,,,,"householdData_3['jtf'] = np.where((householdData_3['joint8'] >= 1) & (householdData_3['joint9'] >= 1), 21, householdData_3['jtf'])"
Rename joint tour categories,step_1,replace,householdData_3,alt_name,jtf,"{1: 'No Joint Tours', 2: '1 Shopping', 3: '1 Maintenance', 4: '1 Eating Out', 5: '1 Visiting', 6: '1 Other Discretionary', 7: '2 Shopping', 8: '1 Shopping / 1 Maintenance', 9: '1 Shopping / 1 Eating Out', 10: '1 Shopping / 1 Visiting', 11: '1 Shopping / 1 Other Discretionary', 12: '2 Maintenance', 13: '1 Maintenance / 1 Eating Out', 14: '1 Maintenance / 1 Visiting', 15: '1 Maintenance / 1 Other Discretionary', 16: '2 Eating Out', 17: '1 Eating Out / 1 Visiting', 18: '1 Eating Out / 1 Other Discretionary', 19: '2 Visiting', 20: '1 Visiting / 1 Other Discretionary', 21: '2 Other Discretionary'}"
#,,,,,,
Add number of total stops for individual tours,step_1,raw,,,,indivTourData_3['num_tot_stops'] = indivTourData_3['num_ib_stops'] + indivTourData_3['num_ob_stops']
Add number of total stops for joint tours,step_1,raw,,,,jointTourData_3['num_tot_stops'] = jointTourData_3['num_ib_stops'] + jointTourData_3['num_ob_stops']
Add variable indicating if next stop is on inbound tour leg to individual trip data,step_1,raw,,,,indivTripData_3['inb_next'] = np.zeros_like(indivTripData_3.index)
Add variable indicating if next stop is on inbound tour leg to individual trip data,step_1,raw,,,,indivTripData_3['inb_next'].iloc[:indivTripData_3.shape[0]-1] = indivTripData_3['inbound'][1:]
Add variable indicating if individual trip is intermediate stop on tour,step_1,raw,,,,"indivTripData_3['stops'] = np.where((indivTripData_3['DPURP'] > 0) & (((indivTripData_3['inbound'] == 0) & (indivTripData_3['inb_next'] == 0)) | ((indivTripData_3['inbound'] == 1) & (indivTripData_3['inb_next'] == 1))), 1, 0)"
Add variable indicating if next stop is on inbound tour leg to joint trip data,step_1,raw,,,,jointTripData_3['inb_next'] = np.zeros_like(jointTripData_3.index)
Add variable indicating if next stop is on inbound tour leg to joint trip data,step_1,raw,,,,jointTripData_3['inb_next'].iloc[:jointTripData_3.shape[0]-1] = jointTripData_3['inbound'][1:]
Add variable indicating if joint trip is intermediate stop on tour,step_1,raw,,,,"jointTripData_3['stops'] = np.where((jointTripData_3['DPURP'] > 0) & (((jointTripData_3['inbound'] == 0) & (jointTripData_3['inb_next'] == 0)) | ((jointTripData_3['inbound'] == 1) & (jointTripData_3['inb_next'] == 1))), 1, 0)"
Classify number of adults,step_1,raw,household_data3,,,"householdData_3['ADULTS'] = householdData_3['hh_id'].map(personData_3[['hh_id', 'person_id', 'age']].query('age >= 18 and age < 99').groupby('hh_id').count()['person_id'])"
Calculate duration for individual tours,step_1,raw,indivTourData_3,,,indivTourData_3['tourdur'] = indivTourData_3['end_period'] - indivTourData_3['start_period'] + 1
Calculate duration for joint tours,step_1,raw,jointTourData_3,,,jointTourData_3['tourdur'] = jointTourData_3['end_period'] - jointTourData_3['start_period'] + 1
#,,,,,,
Classify vehicle ownership category for individual tours,step_3,raw,hh_itours,,,"hh_itours['AUTOSUFF'] = np.where(hh_itours['HHVEH'] == 0, 0, np.where(hh_itours['HHVEH'] < hh_itours['ADULTS'], 1, 2))"
Classify vehicle ownership category for joint tours,step_3,raw,hh_jtours,,,"hh_jtours['AUTOSUFF'] = np.where(hh_jtours['HHVEH'] == 0, 0, np.where(hh_jtours['HHVEH'] < hh_jtours['ADULTS'], 1, 2))"
#,,,,,,
Get outbound chauffuer type,step_3,raw,,,,indivTourData_3['out_chauffeur_ptype'] = (indivTourData_3['hh_id'].astype(str) + '-' + indivTourData_3['driver_num_out'].astype(str)).map(personData_3.set_index('hhper_id')['PERTYPE'])
Get inbound chauffuer type,step_3,raw,,,,indivTourData_3['inb_chauffeur_ptype'] = (indivTourData_3['hh_id'].astype(str) + '-' + indivTourData_3['driver_num_in'].astype(str)).map(personData_3.set_index('hhper_id')['PERTYPE'])
Get tours with active workers,step_3,raw,,,,"active_workers = indivTourData_3[['tour_purpose', 'person_type', 'hh_id', 'person_num']].query('tour_purpose in [""Work"", ""Work-Based""] and person_type in [1, 2]').groupby(['hh_id', 'person_num']).max()['person_type'].reset_index()"
Get tours with active students,step_3,raw,,,,"active_students = indivTourData_3[['tour_purpose', 'person_type', 'hh_id', 'person_num']].query('tour_purpose == ""School"" and person_type in [6, 7, 8]').groupby(['hh_id', 'person_num']).max()['person_type'].reset_index()"
Get tours with active students,step_3,raw,,,,active_students['active_student'] = np.ones_like(active_students.index)
Group active student tours by household,step_3,raw,,,,hh_active_student = active_students.groupby('hh_id').max()['active_student']
Tag active workers with active students in household,step_3,raw,,,,active_workers['active_student'] = active_workers['hh_id'].map(hh_active_student).fillna(0)
List of workers who did outbound rideshare for students,step_3,raw,,,,"out_rs_workers = indivTourData_3[['hh_id', 'person_num', 'tour_id2', 'tour_purpose', 'escort_type_out', 'driver_num_out', 'out_chauffeur_ptype']].query('tour_purpose == ""School"" and escort_type_out == 1')[['hh_id', 'driver_num_out']].value_counts().sort_index().reset_index().rename(columns = {0: 'out_rs_escort'})"
List of workers who did outbound pure escort for students,step_3,raw,,,,"out_pe_workers = indivTourData_3[['hh_id', 'person_num', 'tour_id2', 'tour_purpose', 'escort_type_out', 'driver_num_out', 'out_chauffeur_ptype']].query('tour_purpose == ""School"" and escort_type_out == 2')[['hh_id', 'driver_num_out']].value_counts().sort_index().reset_index().rename(columns = {0: 'out_pe_escort'})"
List of workers who did inbound rideshare for students,step_3,raw,,,,"inb_rs_workers = indivTourData_3[['hh_id', 'person_num', 'tour_id2', 'tour_purpose', 'escort_type_in', 'driver_num_in', 'inb_chauffeur_ptype']].query('tour_purpose == ""School"" and escort_type_in == 1')[['hh_id', 'driver_num_in']].value_counts().sort_index().reset_index().rename(columns = {0: 'inb_rs_escort'})"
List of workers who did inbound pure escort for students,step_3,raw,,,,"inb_pe_workers = indivTourData_3[['hh_id', 'person_num', 'tour_id2', 'tour_purpose', 'escort_type_in', 'driver_num_in', 'inb_chauffeur_ptype']].query('tour_purpose == ""School"" and escort_type_in == 2')[['hh_id', 'driver_num_in']].value_counts().sort_index().reset_index().rename(columns = {0: 'inb_pe_escort'})"
Add escort type to worker type,step_3,raw,,,,"active_workers = active_workers.merge(out_rs_workers, 'left', left_on = ['hh_id', 'person_num'], right_on = ['hh_id', 'driver_num_out'])"
Add escort type to worker type,step_3,raw,,,,"active_workers = active_workers.merge(out_pe_workers, 'left', left_on = ['hh_id', 'person_num'], right_on = ['hh_id', 'driver_num_out'])"
Add escort type to worker type,step_3,raw,,,,"active_workers = active_workers.merge(inb_rs_workers, 'left', left_on = ['hh_id', 'person_num'], right_on = ['hh_id', 'driver_num_in'])"
Add escort type to worker type,step_3,raw,,,,"active_workers = active_workers.merge(inb_pe_workers, 'left', left_on = ['hh_id', 'person_num'], right_on = ['hh_id', 'driver_num_in'])"
Fill null values with 0,step_3,raw,,,,active_workers = active_workers.fillna(0)
Identify outbound escort type,step_3,raw,,,,"active_workers['out_escort_type'] = np.where(active_workers['out_pe_escort'] > 0, 2, np.where(active_workers['out_rs_escort'], 1, 3))"
Identify inbound escort type,step_3,raw,,,,"active_workers['inb_escort_type'] = np.where(active_workers['inb_pe_escort'] > 0, 2, np.where(active_workers['inb_rs_escort'], 1, 3))"
Reset active_workers index,step_3,raw,,,,active_workers = active_workers.reset_index()
#,,,,,,
Add up total population,step_3,raw,,,,total_population = personData_3.shape[0]
Add up total households,step_3,raw,,,,total_households = householdData_3.shape[0]
Add up total tours,step_3,raw,,,,total_tours = indivTourData_3.shape[0] + jointTourData_3['NUMBER_HH_TOTAL'].sum()
Add up total trips,step_3,raw,,,,total_trips = indivTripData_3.shape[0] + jointTripData_3.shape[0]
Add up total stops,step_3,raw,,,,total_stops = indivTripData_3.query('stops == 1').shape[0] + jointTripData_3.query('stops == 1').shape[0]
Add up total VMT,step_3,replace,indivTripData_3,num_travel,trip_mode,"{1: 1, 2: 2, 3: 3.5, 4: 0, 5: 0, 6: 0, 7: 0, 8: 0, 9: 0, 10: 1.1, 11: 1.2, 12: 2, 13: 0}"
Add up total VMT,step_3,raw,,,,"indivTripData_3['vmt'] = np.where(indivTripData_3['num_travel'] > 0, indivTripData_3['od_distance'] / indivTripData_3['num_travel'], 0)"
Add up total VMT,step_3,raw,,,,total_vmt = indivTripData_3['vmt'].sum()
Get totals together into series,step_3,raw,,,,"totals_df = pd.Series([total_population, total_households, total_tours, total_trips, total_stops, total_vmt], [""Population"", ""Households"", ""Tours"", ""Trips"", ""Stops"", ""VMT""])"
Name totals column,step_3,raw,,,,totals_df = pd.DataFrame({'value': totals_df})
Name totals index,step_3,raw,,,,totals_df.index.name = 'Variable'
Write totals data frame,step_3,raw,,,,totals_df.to_csv(r'//sandag.org/transdata/ABM/ABM_FY23/model_runs/2016_1422CB_sxu\visualizer\data_pipeliner\output\totals.csv')
#,,,,,,
Create rates data frame,step_3,raw,,,,"rates_df = pd.Series([totals_df['value']['Tours']/totals_df['value']['Population'], totals_df['value']['Trips']/totals_df['value']['Population'], totals_df['value']['Stops']/totals_df['value']['Population'], totals_df['value']['Trips']/totals_df['value']['Households']], ['Tours per Person', 'Trips per Person', 'Stops per Person', 'Trips per Household'])"
Create rates data frame,step_3,raw,,,,rates_df = pd.DataFrame({'value': rates_df})
Create rates data frame,step_3,raw,,,,rates_df.index.name = 'Variable'
Write rates data frame,step_3,raw,,,,rates_df.to_csv(r'//sandag.org/transdata/ABM/ABM_FY23/model_runs/2016_1422CB_sxu\visualizer\data_pipeliner\output\rates.csv')
#,,,,,,
#,,,,,,
Add totals to average mandatory trip length,step_6,raw,,,,mandTripLengthsTotal['HDISTRICT'] = 'Total'
Add totals to average mandatory trip length,step_6,raw,,,,"mandTripLengths = pd.concat((mandTripLengths, mandTripLengthsTotal))"
Add totals to results by person type,step_6,raw,,,,resultsByPTypeTotal['index'] = 'Total'
Add totals to results by person type,step_6,raw,,,,"resultsByPType = pd.concat((resultsByPType, resultsByPTypeTotal))"
Add total non mandatory trip length,step_6,raw,,,,"nonMandTripLengths.loc[nonMandTripLengths.index.max()+1] = ['Total', nonMandTripLengthsTotal.loc[0, 'avgDist']]"
Add total out of direction distance,step_6,raw,,,,"avgStopOutofDirectionDist_vis.loc[avgStopOutofDirectionDist_vis.index.max()+1] = ['Total', avgStopOutofDirectionDistTotal.loc[0, 'avgDist']]"
#,,,,,,
Rename HDISTRICT to just District,step_6,rename,wfh_summary,,,{'HDISTRICT': 'District'}
Add totals to work from home summary,step_6,raw,,,,"wfh_summary.loc[wfh_summary.index.max()+1] = ['Total', wfh_summary['Workers'].sum(), wfh_summary['WFH'].sum()]"
Get % Work From Home,step_6,column,wfh_summary,%WFH,,WFH/Workers
Add up individual and joint tours by person type,step_6,sum,resultsByPType,tours,"itours,jtours",
Get tour rate,step_6,column,resultsByPType,tour_rate,,tours/active_persons
#,,,,,,
Normalize Escorting Tour Rates,step_6,column,nm_tour_rates,Escorting,,Escorting/TotalPersons
Normalize Shopping Tour Rates,step_6,column,nm_tour_rates,Shopping,,Shopping/TotalPersons
Normalize Maintenance Tour Rates,step_6,column,nm_tour_rates,Maintenance,,Maintenance/TotalPersons
Normazlize Eating Out Tour Rates,step_6,column,nm_tour_rates,EatingOut,,EatingOut/TotalPersons
Normalize Visiting Tour Rates,step_6,column,nm_tour_rates,Visiting,,Visiting/TotalPersons
Normalize Discretionary Tour Rates,step_6,column,nm_tour_rates,Discretionary,,Discretionary/TotalPersons
Normalize All Nonmandatory Tour Rates,step_6,column,nm_tour_rates,All,,All/TotalPersons
Delete total persons column,step_6,raw,,,,del nm_tour_rates['TotalPersons']
Melt nm_tour_rates,step_6,raw,,,,"nm_tour_rates = pd.melt(nm_tour_rates, ['PERTYPE'], var_name = 'tour_purp', value_name = 'tour_rate')"
#,,,,,,
Rename escort type column,step_6,rename,esctype_by_childtype,,,"{'level_0': 'esc_type', 'person_type': 'child_type'}"
Rename escort type column,step_6,rename,esctype_by_chauffeurtype,,,"{'level_0': 'esc_type', 'level_1': 'chauffeur'}"
Rename person type column,step_6,rename,resultsByPType,,,{'index': 'PERTYPE'}
Rename person type column,step_6,rename,tours_pertype_purpose,,,{'person_type': 'PERTYPE'}
#,,,,,,
Recode person type,step_6,replace,inmSummary_vis,PERTYPE,PERTYPE,"{1: '1: Full-Time Worker', 2: '2: Part-Time Worker', 3: '3: University Student', 4: '4: Non-Worker', 5: '5: Retiree', 6: '6: Driving Aged Student', 7: '7: Non-Driving Aged Student', 8: '8: Child To Young for School'}"
Recode person type,step_6,replace,tours_pertype_purpose,PERTYPE,PERTYPE,"{1: '1: Full-Time Worker', 2: '2: Part-Time Worker', 3: '3: University Student', 4: '4: Non-Worker', 5: '5: Retiree', 6: '6: Driving Aged Student', 7: '7: Non-Driving Aged Student', 8: '8: Child To Young for School'}"
Recode person type,step_6,replace,resultsByPType,PERTYPE,PERTYPE,"{1: '1: Full-Time Worker', 2: '2: Part-Time Worker', 3: '3: University Student', 4: '4: Non-Worker', 5: '5: Retiree', 6: '6: Driving Aged Student', 7: '7: Non-Driving Aged Student', 8: '8: Child To Young for School'}"
Recode person type,step_6,replace,pertypeDistbn,PERTYPE,PERTYPE,"{1: '1: Full-Time Worker', 2: '2: Part-Time Worker', 3: '3: University Student', 4: '4: Non-Worker', 5: '5: Retiree', 6: '6: Driving Aged Student', 7: '7: Non-Driving Aged Student', 8: '8: Child To Young for School'}"
Recode person type,step_6,replace,dapSummary_vis,PERTYPE,PERTYPE,"{1: '1: Full-Time Worker', 2: '2: Part-Time Worker', 3: '3: University Student', 4: '4: Non-Worker', 5: '5: Retiree', 6: '6: Driving Aged Student', 7: '7: Non-Driving Aged Student', 8: '8: Child To Young for School'}"
Recode person type,step_6,replace,mtfSummary_vis,PERTYPE,PERTYPE,"{1: '1: Full-Time Worker', 2: '2: Part-Time Worker', 3: '3: University Student', 4: '4: Non-Worker', 5: '5: Retiree', 6: '6: Driving Aged Student', 7: '7: Non-Driving Aged Student', 8: '8: Child To Young for School'}"
Recode person type,step_6,replace,nm_tour_rates,PERTYPE,PERTYPE,"{1: '1: Full-Time Worker', 2: '2: Part-Time Worker', 3: '3: University Student', 4: '4: Non-Worker', 5: '5: Retiree', 6: '6: Driving Aged Student', 7: '7: Non-Driving Aged Student', 8: '8: Child To Young for School'}"
Recode person type,step_6,replace,esctype_by_chauffeurtype,chauffeur,chauffeur,"{1: '1: Full-Time Worker', 2: '2: Part-Time Worker', 3: '3: University Student', 4: '4: Non-Worker', 5: '5: Retiree', 6: '6: Driving Aged Student', 7: '7: Non-Driving Aged Student', 8: '8: Child To Young for School'}"
Recode person type,step_6,replace,esctype_by_childtype,child_type,child_type,"{1: '1: Full-Time Worker', 2: '2: Part-Time Worker', 3: '3: University Student', 4: '4: Non-Worker', 5: '5: Retiree', 6: '6: Driving Aged Student', 7: '7: Non-Driving Aged Student', 8: '8: Child To Young for School'}"
#,,,,,,
Recode person type,step_6,replace,esctype_by_childtype,esc_type,esc_type,"{0: 'No Escort', 1: 'Ride Share', 2: 'Pure Escort', 3: 'No Escort'}"
Recode person type,step_6,replace,esctype_by_chauffeurtype,esc_type,esc_type,"{0: 'No Escort', 1: 'Ride Share', 2: 'Pure Escort', 3: 'No Escort'}"
Recode in escort type,step_6,replace,worker_school_escorting,inb_escort_type,inb_escort_type,"{0: 'No Escort', 1: 'Ride Share', 2: 'Pure Escort', 3: 'No Escort'}"
Recode out escort type,step_6,replace,worker_school_escorting,out_escort_type,out_escort_type,"{0: 'No Escort', 1: 'Ride Share', 2: 'Pure Escort', 3: 'No Escort'}"
#,,,,,,
Rename AGGPURP,step_6,rename,stopDC_vis,,,"{'AGGPURP': 'purpose', 'out_dir_distbin': 'distbin'}"
Rename AGGPURP,step_6,rename,avgStopOutofDirectionDist_vis,,,{'AGGPURP': 'purpose'}
Rename AGGPURP,step_6,rename,tmodeProfile_vis,,,{'AGGPURP': 'purpose'}
Rename AGGPURP,step_6,rename,tourDistProfile_vis,,,"{'AGGPURP': 'purpose', 'tourdistbin': 'distbin'}"
Rename AGGPURP,step_6,rename,tripmodeProfile_vis,,,{'AGGPURP': 'purpose'}
Rename AGGPURP,step_6,rename,nonMandTripLengths,,,{'AGGPURP': 'purpose'}
Rename AGGPURP,step_6,rename,stopDeparture_vis,,,{'AGGPURP': 'purpose'}
Rename AGGPURP,step_6,rename,stopFreqProfile_vis,,,"{'AGGPURP': 'purpose', 'level_0': 'num_stops'}"
Rename AGGPURP,step_6,rename,stopPurposeByTourPurpose_vis,,,"{'AGGPURP': 'tour_purpose', 'DPURP': 'stop_purpose'}"
Rename AGGPURP,step_6,rename,todProfile_vis,,,"{'AGGPURP': 'purpose', 'level_0': 'period'}"
Rename AGGPURP,step_6,rename,tripDeparture_vis,,,{'AGGPURP': 'tour_purpose'}
Rename AGGPURP,step_6,rename,tourDuration,,,{'AGGPURP': 'purpose'}
#,,,,,,
Rename AUTOSUFF column,step_6,rename,tmodeProfile_vis,,,{'AUTOSUFF': 'OwnershipCategory'}
Recode auto ownership category,step_6,replace,tmodeProfile_vis,OwnershipCategory,OwnershipCategory,"{0: '0: No Vehicles', 1: '1: 1+ Veh/Adults > Veh', 2: '2: Vehicles >= Adults'}"
Rename mandatory distance distribution columns,step_6,rename,mandTLFD,,,"{'level_0': 'distbin', 'HDISTRICT': 'District'}"
Recode tour mode,step_6,replace,tmodeProfile_vis,tour_mode,tour_mode,"{1: '01: SOV', 2: '02: Shared Ride 2', 3: '03: Shared Ride 3+', 4: '04: Walk', 5: '05: Bike', 6: '06: Walk to Transit', 7: '07: PNR to Transit', 8: '08: KNR to Transit', 9: '09: TNC to Transit', 10: '10: Taxi', 11: '11: TNC Single', 12: '12: TNC Shared', 13: '13: School Bus'}"
Recode tour mode,step_6,replace,tripmodeProfile_vis,tour_mode,tour_mode,"{1: '01: SOV', 2: '02: Shared Ride 2', 3: '03: Shared Ride 3+', 4: '04: Walk', 5: '05: Bike', 6: '06: Walk to Transit', 7: '07: PNR to Transit', 8: '08: KNR to Transit', 9: '09: TNC to Transit', 10: '10: Taxi', 11: '11: TNC Single', 12: '12: TNC Shared', 13: '13: School Bus'}"
Recode trip mode,step_6,replace,tripmodeProfile_vis,trip_mode,trip_mode,"{1: '01: SOV', 2: '02: Shared Ride 2', 3: '03: Shared Ride 3+', 4: '04: Walk', 5: '05: Bike', 6: '06: Walk to Transit', 7: '07: PNR to Transit', 8: '08: KNR to Transit', 9: '09: TNC to Transit', 10: '10: Taxi', 11: '11: TNC Single', 12: '12: TNC Shared', 13: '13: School Bus'}"
Drop null values,step_6,raw,,,,tmodeProfile_vis = tmodeProfile_vis.dropna()
Melt mand TLFD,step_6,raw,,,,"mandTLFD = pd.melt(mandTLFD, ['distbin', 'District'], var_name = 'purpose')"
Rename mandatory trip length district,step_6,rename,mandTripLengths,,,{'HDISTRICT': 'District'}
Melt mandatory trip lengths,step_6,raw,,,,"mandTripLengths = pd.melt(mandTripLengths, ['District'], var_name = 'purpose')"
Recode mandatory tour frequency category,step_6,replace,mtfSummary_vis,imf_choice,imf_choice,"{0: ""No Mand Tours"", 1: ""1 Work"", 2: ""2+ Work"", 3: ""1 School"", 4: ""2+ School"", 5: ""1 Work & 1 School""}"
Melt stopFreqProfile_vis,step_6,raw,,,,"stopFreqProfile_vis = pd.melt(stopFreqProfile_vis, ['num_stops', 'purpose'], var_name = 'Direction')"
Recode stop purpose,step_6,replace,stopPurposeByTourPurpose_vis,stop_purpose,stop_purpose,"{1: '01: Work', 2: '02: University', 3: '03: School', 4: '04: Escort', 5: '05: Shopping', 6: '06: Maintenance', 7: '07: Eating', 8: '08: Visiting', 9: '09: Other Discretionary', 10: '10: Work-Related'}"
#,,,,,,
Recode HH District,step_6,replace,wfh_summary,District,District,"{1: '1: Downtown', 2: '2: Central', 3: '3: North City', 4: '4: South Suburban', 5: '5: East Suburban', 6: '6: North County West', 7: '7: North County East', 8: '8: East County'}"
Recode HH District,step_6,replace,districtFlows,HDISTRICT,HDISTRICT,"{1: '1: Downtown', 2: '2: Central', 3: '3: North City', 4: '4: South Suburban', 5: '5: East Suburban', 6: '6: North County West', 7: '7: North County East', 8: '8: East County'}"
Recode Work District,step_6,replace,districtFlows,WDISTRICT,WDISTRICT,"{1: '1: Downtown', 2: '2: Central', 3: '3: North City', 4: '4: South Suburban', 5: '5: East Suburban', 6: '6: North County West', 7: '7: North County East', 8: '8: East County'}"
Recode mandatory tour length district,step_6,replace,mandTLFD,District,District,"{1: '1: Downtown', 2: '2: Central', 3: '3: North City', 4: '4: South Suburban', 5: '5: East Suburban', 6: '6: North County West', 7: '7: North County East', 8: '8: East County'}"
Recode mandatory tour length district,step_6,replace,mandTripLengths,District,District,"{1: '1: Downtown', 2: '2: Central', 3: '3: North City', 4: '4: South Suburban', 5: '5: East Suburban', 6: '6: North County West', 7: '7: North County East', 8: '8: East County'}"
#,,,,,,
Recode time period,step_6,apply,todProfile_vis,period,period,lambda x: 0.5*x+4.25
Recode time period,step_6,apply,tripDeparture_vis,stop_period,stop_period,lambda x: 0.5*x+4.25
Recode time period,step_6,apply,stopDeparture_vis,stop_period,stop_period,lambda x: 0.5*x+4.25
Recode tour duration,step_6,apply,tourDuration,tourdur,tourdur,lambda x: 0.5*x
#,,,,,,
Recode daily activity pattern,step_6,replace,dapSummary_vis,activity_pattern,activity_pattern,"{'H': 'Home', 'M': 'Mandatory', 'N': 'Non-Mandatory'}"
#,,,,,,
Bin tour TOD profile into assignment time periods,step_6,bin,todProfile_vis,skim_period,period,"[3, 6, 9, 15.5, 19, 27]"
Bin tour TOD profile into assignment time periods,step_6,apply,todProfile_vis,skim_period,skim_period,"(lambda x: int(float(str(x).split(', ')[1].split(']')[0])))"
Bin tour TOD profile into assignment time periods,step_6,replace,todProfile_vis,skim_period,skim_period,"{6: '1: EA', 9: '2: AM', 15: '3: MD', 19: '4: PM', 27: '5: EV'}"
Bin stop TOD profile into assignment time periods,step_6,bin,stopDeparture_vis,stop_skim_period,stop_period,"[3, 6, 9, 15.5, 19, 27]"
Bin stop TOD profile into assignment time periods,step_6,apply,stopDeparture_vis,stop_skim_period,stop_skim_period,"(lambda x: int(float(str(x).split(', ')[1].split(']')[0])))"
Bin stop TOD profile into assignment time periods,step_6,replace,stopDeparture_vis,stop_skim_period,stop_skim_period,"{6: '1: EA', 9: '2: AM', 15: '3: MD', 19: '4: PM', 27: '5: EV'}"
Bin trip TOD profile into assignment time periods,step_6,bin,tripDeparture_vis,stop_skim_period,stop_period,"[3, 6, 9, 15.5, 19, 27]"
Bin trip TOD profile into assignment time periods,step_6,apply,tripDeparture_vis,stop_skim_period,stop_skim_period,"(lambda x: int(float(str(x).split(', ')[1].split(']')[0])))"
Bin trip TOD profile into assignment time periods,step_6,replace,tripDeparture_vis,stop_skim_period,stop_skim_period,"{6: '1: EA', 9: '2: AM', 15: '3: MD', 19: '4: PM', 27: '5: EV'}"
